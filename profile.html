<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kalk.Bot Profile</title>
  <link rel="stylesheet" href="eg.css">
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

    const firebaseConfig = {
  apiKey: "AIzaSyBdsu6eudfC9zHM7W54Q2WKu92xlWdyPk4",
  authDomain: "islamicsupplications-dc167.firebaseapp.com",
  databaseURL: "https://islamicsupplications-dc167-default-rtdb.firebaseio.com",
  projectId: "islamicsupplications-dc167",
  storageBucket: "islamicsupplications-dc167.appspot.com",
  messagingSenderId: "729945511743",
  appId: "1:729945511743:web:ce98cbfdf3f6f4becd658a",
  measurementId: "G-6MLJL225LX"
   ):

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    let currentUser = null;
    let currentLang = "en";

    // ترجمات
    const translations = {
      en: {
        username: "Username",
        fullname: "Full Name",
        email: "Email",
        phone: "Phone",
        birthdate: "Birth Date",
        balance: "Balance",
        subscription: "Subscription",
        endDate: "End Date",
        botStatus: "Bot Status",
        recharge: "Recharge",
        subSection: "Subscription",
        account: "Account",
        active: "✅ Active",
        inactive: "❌ Inactive",
        rechargeBtn: "💳 Recharge",
        sub1: "1 Month (2.50$)",
        sub3: "3 Months (7.50$)",
        sub12: "1 Year (30$)",
        cancel: "Cancel",
        botData: "Bot Data",
        edit: "Edit Profile",
        logout: "Logout",
        insufficient: "Insufficient balance!"
      },
      ar: {
        username: "اسم المستخدم",
        fullname: "الاسم الكامل",
        email: "البريد الإلكتروني",
        phone: "رقم الهاتف",
        birthdate: "تاريخ الميلاد",
        balance: "الرصيد",
        subscription: "الاشتراك",
        endDate: "تاريخ الانتهاء",
        botStatus: "حالة البوت",
        recharge: "إعادة شحن",
        subSection: "الاشتراك",
        account: "الحساب",
        active: "✅ مفعل",
        inactive: "❌ غير مفعل",
        rechargeBtn: "💳 شحن",
        sub1: "شهر (2.50$)",
        sub3: "3 أشهر (7.50$)",
        sub12: "سنة (30$)",
        cancel: "إلغاء",
        botData: "بيانات البوت",
        edit: "تعديل الحساب",
        logout: "تسجيل الخروج",
        insufficient: "الرصيد غير كافي!"
      }
    };

    // تحميل بيانات المستخدم
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        await loadUserData();
      } else {
        window.location.href = "index.html";
      }
    });

    async function loadUserData() {
      if (!currentUser) return;
      const docRef = doc(db, "users", currentUser.uid);
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        const data = docSnap.data();
        const t = translations[currentLang];
        document.getElementById("username").textContent = data.username || "N/A";
        document.getElementById("fullname").textContent = data.fullname || "N/A";
        document.getElementById("email").textContent = data.email;
        document.getElementById("phone").textContent = data.phone || "N/A";
        document.getElementById("birthdate").textContent = data.birthdate || "N/A";
        document.getElementById("balance").textContent = (data.balance || 0).toFixed(2) + " $";
        document.getElementById("subscription").textContent = data.subscription || "None";
        document.getElementById("end-date").textContent = data.endDate || "N/A";
        document.getElementById("bot-status").textContent = data.botActive ? t.active : t.inactive;

        document.getElementById("profile-pic").src = data.photoURL || "https://via.placeholder.com/150";
      }
    }

    // تغيير اللغة
    window.changeLanguage = function(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      const t = translations[lang];

      document.querySelector("[data-username-label]").textContent = t.username;
      document.querySelector("[data-fullname-label]").textContent = t.fullname;
      document.querySelector("[data-email-label]").textContent = t.email;
      document.querySelector("[data-phone-label]").textContent = t.phone;
      document.querySelector("[data-birthdate-label]").textContent = t.birthdate;
      document.querySelector("[data-balance-label]").textContent = t.balance;
      document.querySelector("[data-subscription-label]").textContent = t.subscription;
      document.querySelector("[data-enddate-label]").textContent = t.endDate;
      document.querySelector("[data-botstatus-label]").textContent = t.botStatus;

      document.getElementById("recharge-title").textContent = t.recharge;
      document.getElementById("subscription-title").textContent = t.subSection;
      document.getElementById("account-title").textContent = t.account;

      document.getElementById("recharge-btn").textContent = t.rechargeBtn;
      document.getElementById("sub1-btn").textContent = t.sub1;
      document.getElementById("sub3-btn").textContent = t.sub3;
      document.getElementById("sub12-btn").textContent = t.sub12;
      document.getElementById("cancel-btn").textContent = t.cancel;
      document.getElementById("bot-btn").textContent = t.botData;
      document.getElementById("edit-btn").textContent = t.edit;
      document.getElementById("logout-btn").textContent = t.logout;

      loadUserData();
    };

    // دفع الاشتراك من الرصيد
    window.renewSub = async function(months) {
      if (!currentUser) return;
      const docRef = doc(db, "users", currentUser.uid);
      const docSnap = await getDoc(docRef);
      if (!docSnap.exists()) return alert(translations[currentLang].insufficient);

      const data = docSnap.data();
      let cost = months === 1 ? 2.5 : months === 3 ? 7.5 : 30;
      if ((data.balance || 0) < cost) return alert(translations[currentLang].insufficient);

      const newBalance = (data.balance || 0) - cost;
      await updateDoc(docRef, {
        balance: newBalance,
        subscription: months + (currentLang === "ar" ? " شهر" : " Month"),
        endDate: calculateEndDate(months)
      });
      alert(currentLang === "ar" ? "تم تجديد الاشتراك!" : "Subscription renewed!");
      loadUserData();
    };

    function calculateEndDate(months) {
      const now = new Date();
      now.setMonth(now.getMonth() + months);
      return now.toLocaleDateString(currentLang === "ar" ? "ar-EG" : "en-US");
    }

    window.cancelSub = async function() {
      if (!currentUser) return;
      const docRef = doc(db, "users", currentUser.uid);
      await updateDoc(docRef, { subscription: "", endDate: "" });
      alert(currentLang === "ar" ? "تم إلغاء الاشتراك!" : "Subscription cancelled!");
      loadUserData();
    };

    // الأزرار الأساسية
    window.logout = async function() { await signOut(auth); window.location.href = "index.html"; }
    window.goToBot = function() { window.location.href = "botData.html"; }
    window.goToEditProfile = function() { window.location.href = "edit-profile.html"; }
    window.recharge = function() { window.location.href = "recharge.html"; }
  </script>
</head>
<body>
  <div class="language-selector">
    <select onchange="changeLanguage(this.value)">
      <option value="en" selected>English</option>
      <option value="ar">العربية</option>
    </select>
  </div>

  <div class="card">
    <img id="profile-pic" class="profile-pic" src="https://via.placeholder.com/150" alt="Profile Picture">

    <div class="data-grid">
      <div class="data-box"><span class="data-icon">👤</span><div><p data-username-label>Username:</p><p id="username">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">📝</span><div><p data-fullname-label>Full Name:</p><p id="fullname">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">📧</span><div><p data-email-label>Email:</p><p id="email">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">📱</span><div><p data-phone-label>Phone:</p><p id="phone">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">🎂</span><div><p data-birthdate-label>Birth Date:</p><p id="birthdate">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">💰</span><div><p data-balance-label>Balance:</p><p id="balance">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">🗓️</span><div><p data-subscription-label>Subscription:</p><p id="subscription">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">⏳</span><div><p data-enddate-label>End Date:</p><p id="end-date">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">🤖</span><div><p data-botstatus-label>Bot Status:</p><p id="bot-status">Loading...</p></div></div>
    </div>

    <div class="section">
      <h3 id="recharge-title">Recharge</h3>
      <button id="recharge-btn" class="btn-success" onclick="recharge()">💳 Recharge</button>
    </div>

    <div class="section">
      <h3 id="subscription-title">Subscription</h3>
      <button id="sub1-btn" class="btn-primary" onclick="renewSub(1)">1 Month (2.50$)</button>
      <button id="sub3-btn" class="btn-primary" onclick="renewSub(3)">3 Months (7.50$)</button>
      <button id="sub12-btn" class="btn-primary" onclick="renewSub(12)">1 Year (30$)</button>
      <button id="cancel-btn" class="btn-danger" onclick="cancelSub()">Cancel</button>
    </div>

    <div class="section">
      <h3 id="account-title">Account</h3>
      <button id="bot-btn" class="btn-primary" onclick="goToBot()">Bot Data</button>
      <button id="edit-btn" class="btn-primary" onclick="goToEditProfile()">Edit Profile</button>
      <button id="logout-btn" class="btn-danger" onclick="logout()">Logout</button>
    </div>
  </div>
</body>
</html>
