<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kalk.Bot Profile</title>
  <link rel="stylesheet" href="eg.css">
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";  
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";  
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";  

    const firebaseConfig = {
      apiKey: "AIzaSyBGFMZtSytIPzF4XYLyA34DpF5q_k-UPL8",
      authDomain: "fir-dba4c.firebaseapp.com",
      projectId: "fir-dba4c",
      storageBucket: "fir-dba4c.firebasestorage.app",
      messagingSenderId: "160255207915",
      appId: "1:160255207915:web:ce8e69d43f62daf476d1ae",
      measurementId: "G-GYPNMR85G2"
    };

    const app = initializeApp(firebaseConfig);  
    const auth = getAuth(app);  
    const db = getFirestore(app);  
    let currentUser = null;  

    onAuthStateChanged(auth, async (user) => {  
      if (user) {  
        currentUser = user;  
        await loadUserData();  
      } else {  
        window.location.href = "index.html";  
      }  
    });  

    async function loadUserData() {  
      if (!currentUser) return;  
      const docRef = doc(db, "users", currentUser.uid);  
      const docSnap = await getDoc(docRef);  
      if (docSnap.exists()) {  
        const data = docSnap.data();  
        document.getElementById("username").textContent = data.username || "N/A";  
        document.getElementById("fullname").textContent = data.fullname || "N/A";  
        document.getElementById("email").textContent = data.email;  
        document.getElementById("phone").textContent = data.phone || "N/A";  
        document.getElementById("birthdate").textContent = data.birthdate || "N/A";  
        document.getElementById("balance").textContent = (data.balance || 0).toFixed(2) + " $";  
        document.getElementById("subscription").textContent = data.subscription || "None";  
        document.getElementById("end-date").textContent = data.endDate || "N/A";  
        document.getElementById("bot-status").textContent = data.botActive ? "✅ Active" : "❌ Inactive";  

        document.getElementById("profile-pic").src = data.photoURL || "https://via.placeholder.com/150";  
      }  
    }  

    window.logout = async function() {  
      await signOut(auth);  
      window.location.href = "index.html";  
    }  

    window.goToBot = function() { window.location.href = "botData.html"; }
    window.goToEditProfile = function() { window.location.href = "edit-profile.html"; }
    window.goBack = function() { window.history.back(); }

    window.renewSub = function(months) { window.location.href = "recharge.html?months=" + months; }
    window.cancelSub = function() { window.location.href = "recharge.html?cancel=true"; }
    window.recharge = function() { window.location.href = "recharge.html"; }

    // تبديل اللغة (افتراضي إنجليزي)
    const langMap = {
      "Recharge": { ar: "شحن", en: "Recharge" },
      "Subscription": { ar: "الاشتراك", en: "Subscription" },
      "Account": { ar: "الحساب", en: "Account" },
      "Username:": { ar: "اسم المستخدم:", en: "Username:" },
      "Full Name:": { ar: "الاسم الكامل:", en: "Full Name:" },
      "Email:": { ar: "البريد الإلكتروني:", en: "Email:" },
      "Phone:": { ar: "الهاتف:", en: "Phone:" },
      "Birth Date:": { ar: "تاريخ الميلاد:", en: "Birth Date:" },
      "Balance:": { ar: "الرصيد:", en: "Balance:" },
      "Subscription:": { ar: "الاشتراك:", en: "Subscription:" },
      "End Date:": { ar: "تاريخ الانتهاء:", en: "End Date:" },
      "Bot Status:": { ar: "حالة البوت:", en: "Bot Status:" },
      "1 Month (2.50$)": { ar: "شهر (2.50$)", en: "1 Month (2.50$)" },
      "3 Months (7.50$)": { ar: "3 شهور (7.50$)", en: "3 Months (7.50$)" },
      "1 Year (30$)": { ar: "سنة (30$)", en: "1 Year (30$)" },
      "Cancel": { ar: "إلغاء", en: "Cancel" },
      "Bot Data": { ar: "بيانات البوت", en: "Bot Data" },
      "Edit Profile": { ar: "تعديل الملف", en: "Edit Profile" },
      "Back": { ar: "رجوع", en: "Back" },
      "Logout": { ar: "تسجيل خروج", en: "Logout" }
    };

    window.setLanguage = function(lang) {
      // الاتجاه
      document.body.setAttribute('dir', lang === 'ar' ? 'rtl' : 'ltr');
      document.documentElement.lang = lang;

      // تبديل النصوص
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        const map = langMap[key];
        if (map) el.textContent = map[lang];
      });
    };

    // افتراضي إنجليزي
    window.addEventListener('DOMContentLoaded', () => setLanguage('en'));
  </script>
</head>
<body>

  <!-- Language Selector -->
  <div class="language-selector">
    <select onchange="setLanguage(this.value)">
      <option value="en" selected>English</option>
      <option value="ar">العربية</option>
    </select>
  </div>

  <div class="card">

    <img id="profile-pic" class="profile-pic" src="https://via.placeholder.com/150" alt="Profile Picture">
    
    <!-- بيانات المستخدم في مربعات -->
    <div class="data-grid">

      <div class="data-box"><span class="data-icon">👤</span>
        <div><p data-i18n="Username:">Username:</p><p id="username">Loading...</p></div>
      </div>

      <div class="data-box"><span class="data-icon">📝</span>
        <div><p data-i18n="Full Name:">Full Name:</p><p id="fullname">Loading...</p></div>
      </div>

      <div class="data-box"><span class="data-icon">📧</span>
        <div><p data-i18n="Email:">Email:</p><p id="email">Loading...</p></div>
      </div>

      <div class="data-box"><span class="data-icon">📱</span>
        <div><p data-i18n="Phone:">Phone:</p><p id="phone">Loading...</p></div>
      </div>

      <div class="data-box"><span class="data-icon">🎂</span>
        <div><p data-i18n="Birth Date:">Birth Date:</p><p id="birthdate">Loading...</p></div>
      </div>

      <div class="data-box"><span class="data-icon">💰</span>
        <div><p data-i18n="Balance:">Balance:</p><p id="balance">Loading...</p></div>
      </div>

      <div class="data-box"><span class="data-icon">🗓️</span>
        <div><p data-i18n="Subscription:">Subscription:</p><p id="subscription">Loading...</p></div>
      </div>

      <div class="data-box"><span class="data-icon">⏳</span>
        <div><p data-i18n="End Date:">End Date:</p><p id="end-date">Loading...</p></div>
      </div>

      <div class="data-box"><span class="data-icon">🤖</span>
        <div><p data-i18n="Bot Status:">Bot Status:</p><p id="bot-status">Loading...</p></div>
      </div>

    </div>

    <!-- أقسام الأزرار -->
    <div class="section">
      <h3 data-i18n="Recharge">Recharge</h3>
      <button class="btn-success" onclick="recharge()">💳 <span data-i18n="Recharge">Recharge</span></button>
    </div>

    <div class="section">
      <h3 data-i18n="Subscription">Subscription</h3>
      <button class="btn-primary" onclick="renewSub(1)"><span data-i18n="1 Month (2.50$)">1 Month (2.50$)</span></button>
      <button class="btn-primary" onclick="renewSub(3)"><span data-i18n="3 Months (7.50$)">3 Months (7.50$)</span></button>
      <button class="btn-primary" onclick="renewSub(12)"><span data-i18n="1 Year (30$)">1 Year (30$)</span></button>
      <button class="btn-danger" onclick="cancelSub()"><span data-i18n="Cancel">Cancel</span></button>
    </div>

    <div class="section">
      <h3 data-i18n="Account">Account</h3>
      <button class="btn-primary" onclick="goToBot()"><span data-i18n="Bot Data">Bot Data</span></button>
      <button class="btn-primary" onclick="goToEditProfile()"><span data-i18n="Edit Profile">Edit Profile</span></button>
      <button class="btn-secondary" onclick="goBack()"><span data-i18n="Back">Back</span></button>
      <button class="btn-danger" onclick="logout()"><span data-i18n="Logout">Logout</span></button>
    </div>

  </div>

</body>
</html>
