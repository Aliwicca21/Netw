<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kalk.Bot Profile</title>
  <link rel="stylesheet" href="eg.css">
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

    // ==========================
    // Firebase configuration ÿßŸÑÿ¨ÿØŸäÿØ
    // ==========================
    const firebaseConfig = {
      apiKey: "AIzaSyDavI-NCLUrH6MvK-cKntmDJ0C90kzS0Pk",
      authDomain: "my-application-5e7ee.firebaseapp.com",
      databaseURL: "https://my-application-5e7ee-default-rtdb.firebaseio.com",
      projectId: "my-application-5e7ee",
      storageBucket: "my-application-5e7ee.appspot.com",
      messagingSenderId: "425036201138",
      appId: "1:425036201138:web:951f8a34125eff4b425dab",
      measurementId: "G-8QEZ0GZ73D"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    let currentUser = null;
    let currentLang = "en";

    // ==========================
    // ÿ™ÿ±ÿ¨ŸÖÿßÿ™
    // ==========================
    const translations = {
      en: {
        username: "Username",
        fullname: "Full Name",
        email: "Email",
        phone: "Phone",
        birthdate: "Birth Date",
        balance: "Balance",
        subscription: "Subscription",
        endDate: "End Date",
        botStatus: "Bot Status",
        recharge: "Recharge",
        subSection: "Subscription",
        account: "Account",
        active: "‚úÖ Active",
        inactive: "‚ùå Inactive",
        rechargeBtn: "üí≥ Recharge",
        sub1: "1 Month (2.50$)",
        sub3: "3 Months (7.50$)",
        sub12: "1 Year (30$)",
        cancel: "Cancel",
        botData: "Bot Data",
        edit: "Edit Profile",
        logout: "Logout",
        insufficient: "Insufficient balance!"
      },
      ar: {
        username: "ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ",
        fullname: "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÉÿßŸÖŸÑ",
        email: "ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä",
        phone: "ÿ±ŸÇŸÖ ÿßŸÑŸáÿßÿ™ŸÅ",
        birthdate: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸäŸÑÿßÿØ",
        balance: "ÿßŸÑÿ±ÿµŸäÿØ",
        subscription: "ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉ",
        endDate: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ°",
        botStatus: "ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™",
        recharge: "ÿ•ÿπÿßÿØÿ© ÿ¥ÿ≠ŸÜ",
        subSection: "ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉ",
        account: "ÿßŸÑÿ≠ÿ≥ÿßÿ®",
        active: "‚úÖ ŸÖŸÅÿπŸÑ",
        inactive: "‚ùå ÿ∫Ÿäÿ± ŸÖŸÅÿπŸÑ",
        rechargeBtn: "üí≥ ÿ¥ÿ≠ŸÜ",
        sub1: "ÿ¥Ÿáÿ± (2.50$)",
        sub3: "3 ÿ£ÿ¥Ÿáÿ± (7.50$)",
        sub12: "ÿ≥ŸÜÿ© (30$)",
        cancel: "ÿ•ŸÑÿ∫ÿßÿ°",
        botData: "ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ®Ÿàÿ™",
        edit: "ÿ™ÿπÿØŸäŸÑ ÿßŸÑÿ≠ÿ≥ÿßÿ®",
        logout: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
        insufficient: "ÿßŸÑÿ±ÿµŸäÿØ ÿ∫Ÿäÿ± ŸÉÿßŸÅŸä!"
      }
    };

    // ==========================
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
    // ==========================
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;
        await loadUserData();
      } else {
        window.location.href = "index.html";
      }
    });

    async function loadUserData() {
      if (!currentUser) return;
      const docRef = doc(db, "users", currentUser.uid);
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        const data = docSnap.data();
        const t = translations[currentLang];

        document.getElementById("username").textContent = data.username || "N/A";
        document.getElementById("fullname").textContent = data.fullname || "N/A";
        document.getElementById("email").textContent = data.email;
        document.getElementById("phone").textContent = data.phone || "N/A";
        document.getElementById("birthdate").textContent = data.birthdate || "N/A";
        document.getElementById("balance").textContent = (data.balance || 0).toFixed(2) + " $";
        document.getElementById("subscription").textContent = data.subscription || "None";
        document.getElementById("end-date").textContent = data.endDate || "N/A";
        document.getElementById("bot-status").textContent = data.botActive ? t.active : t.inactive;

        document.getElementById("profile-pic").src = data.photoURL || "https://via.placeholder.com/150";
      }
    }

    // ==========================
    // ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÑÿ∫ÿ©
    // ==========================
    window.changeLanguage = function(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      const t = translations[lang];

      document.querySelector("[data-username-label]").textContent = t.username;
      document.querySelector("[data-fullname-label]").textContent = t.fullname;
      document.querySelector("[data-email-label]").textContent = t.email;
      document.querySelector("[data-phone-label]").textContent = t.phone;
      document.querySelector("[data-birthdate-label]").textContent = t.birthdate;
      document.querySelector("[data-balance-label]").textContent = t.balance;
      document.querySelector("[data-subscription-label]").textContent = t.subscription;
      document.querySelector("[data-enddate-label]").textContent = t.endDate;
      document.querySelector("[data-botstatus-label]").textContent = t.botStatus;

      document.getElementById("recharge-title").textContent = t.recharge;
      document.getElementById("subscription-title").textContent = t.subSection;
      document.getElementById("account-title").textContent = t.account;

      document.getElementById("recharge-btn").textContent = t.rechargeBtn;
      document.getElementById("sub1-btn").textContent = t.sub1;
      document.getElementById("sub3-btn").textContent = t.sub3;
      document.getElementById("sub12-btn").textContent = t.sub12;
      document.getElementById("cancel-btn").textContent = t.cancel;
      document.getElementById("bot-btn").textContent = t.botData;
      document.getElementById("edit-btn").textContent = t.edit;
      document.getElementById("logout-btn").textContent = t.logout;

      loadUserData();
    };

    // ==========================
    // ÿßÿ¥ÿ™ÿ±ÿßŸÉ ŸÖŸÜ ÿßŸÑÿ±ÿµŸäÿØ
    // ==========================
    window.renewSub = async function(months) {
      if (!currentUser) return;
      const docRef = doc(db, "users", currentUser.uid);
      const docSnap = await getDoc(docRef);
      if (!docSnap.exists()) return alert(translations[currentLang].insufficient);

      const data = docSnap.data();
      let cost = months === 1 ? 2.5 : months === 3 ? 7.5 : 30;
      if ((data.balance || 0) < cost) return alert(translations[currentLang].insufficient);

      const newBalance = (data.balance || 0) - cost;
      await updateDoc(docRef, {
        balance: newBalance,
        subscription: months + (currentLang === "ar" ? " ÿ¥Ÿáÿ±" : " Month"),
        endDate: calculateEndDate(months)
      });
      alert(currentLang === "ar" ? "ÿ™ŸÖ ÿ™ÿ¨ÿØŸäÿØ ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉ!" : "Subscription renewed!");
      loadUserData();
    };

    function calculateEndDate(months) {
      const now = new Date();
      now.setMonth(now.getMonth() + months);
      return now.toLocaleDateString(currentLang === "ar" ? "ar-EG" : "en-US");
    }

    window.cancelSub = async function() {
      if (!currentUser) return;
      const docRef = doc(db, "users", currentUser.uid);
      await updateDoc(docRef, { subscription: "", endDate: "" });
      alert(currentLang === "ar" ? "ÿ™ŸÖ ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉ!" : "Subscription cancelled!");
      loadUserData();
    };

    // ==========================
    // ÿ£ÿ≤ÿ±ÿßÿ± ÿ£ÿ≥ÿßÿ≥Ÿäÿ©
    // ==========================
    window.logout = async function() { await signOut(auth); window.location.href = "index.html"; }
    window.goToBot = function() { window.location.href = "botData.html"; }
    window.goToEditProfile = function() { window.location.href = "edit-profile.html"; }
    window.recharge = function() { window.location.href = "recharge.html"; }

  </script>
</head>
<body>
  <div class="language-selector">
    <select onchange="changeLanguage(this.value)">
      <option value="en" selected>English</option>
      <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
    </select>
  </div>

  <div class="card">
    <img id="profile-pic" class="profile-pic" src="https://via.placeholder.com/150" alt="Profile Picture">

    <div class="data-grid">
      <div class="data-box"><span class="data-icon">üë§</span><div><p data-username-label>Username:</p><p id="username">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">üìù</span><div><p data-fullname-label>Full Name:</p><p id="fullname">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">üìß</span><div><p data-email-label>Email:</p><p id="email">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">üì±</span><div><p data-phone-label>Phone:</p><p id="phone">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">üéÇ</span><div><p data-birthdate-label>Birth Date:</p><p id="birthdate">Loading...</p></div></div>
      <div class="data-box"><span class="data-icon">üí∞</span><div><p data-balance-label>Balance:</p><p id="balance">Loading...</
