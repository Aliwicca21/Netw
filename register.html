<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</title>
<link rel="stylesheet" href="auth.css">
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBGFMZtSytIPzF4XYLyA34DpF5q_k-UPL8",
  authDomain: "fir-dba4c.firebaseapp.com",
  projectId: "fir-dba4c",
  storageBucket: "fir-dba4c.firebasestorage.app",
  messagingSenderId: "160255207915",
  appId: "1:160255207915:web:ce8e69d43f62daf476d1ae",
  measurementId: "G-GYPNMR85G2"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ===== Ø§Ù„ØªØ±Ø¬Ù…Ø© =====
const translations = {
  en: {
    title: "Create New Account",
    email: "Email",
    password: "Password",
    phone: "Phone (+20123456789)",
    username: "Username",
    fullname: "Full Name",
    birthdate: "Birth Date",
    submit: "Sign Up",
    login: "Already have an account? Login"
  },
  ar: {
    title: "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯",
    email: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
    password: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±",
    phone: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (+20123456789)",
    username: "Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…",
    fullname: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„",
    birthdate: "ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯",
    submit: "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨",
    login: "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"
  }
};

let currentLang = "ar";

function updateText() {
  const t = translations[currentLang];
  document.getElementById("form-title").textContent = t.title;
  document.getElementById("email").placeholder = t.email;
  document.getElementById("password").placeholder = t.password;
  document.getElementById("phone").placeholder = t.phone;
  document.getElementById("username").placeholder = t.username;
  document.getElementById("fullname").placeholder = t.fullname;
  document.getElementById("birthdate").placeholder = t.birthdate;
  document.getElementById("submit-btn").textContent = t.submit;
  document.getElementById("login-btn").textContent = t.login;
  document.body.dir = currentLang === "ar" ? "rtl" : "ltr";
  document.documentElement.lang = currentLang;
}

// ===== ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© =====
window.changeLanguage = function(lang) {
  currentLang = lang;
  updateText();
}

// ===== Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ =====
window.signupUser = async function() {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;
    const phone = document.getElementById("phone").value.trim();
    const username = document.getElementById("username").value.trim();
    const fullname = document.getElementById("fullname").value.trim();
    const birthdate = document.getElementById("birthdate").value;

    if(!email || !password || !phone || !username || !fullname || !birthdate){
        return alert(currentLang === "ar" ? "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©!" : "All fields are required!");
    }

    if(!phone.startsWith("+") || phone.replace(/\D/g,'').length < 5){
        return alert(currentLang === "ar" ? "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­!" : "Invalid phone number!");
    }

    try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        await setDoc(doc(db, "users", user.uid), {
            email, phone, username, fullname, birthdate, balance: 0, subscription: null
        });

        alert(currentLang === "ar" ? "ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…" : "Account created successfully âœ…");
        window.location.href = "index.html";
    } catch(error){
        alert(currentLang === "ar" ? "Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message : "Error: " + error.message);
    }
}

// ===== Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ =====
window.goToLogin = function(){
    window.location.href = "index.html";
}

window.addEventListener('DOMContentLoaded', updateText);
</script>
</head>
<body>
<!-- Language Selector -->
<div class="language-selector">
  <select onchange="changeLanguage(this.value)">
    <option value="ar" selected>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
    <option value="en">English</option>
  </select>
</div>

<div class="card">
  <h2 id="form-title">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
  <form onsubmit="event.preventDefault(); signupUser();">
    <div class="input-group"><span>ğŸ“§</span><input type="email" id="email" required></div>
    <div class="input-group"><span>ğŸ”’</span><input type="password" id="password" required></div>
    <div class="input-group"><span>ğŸ“±</span><input type="text" id="phone" required></div>
    <div class="input-group"><span>ğŸ‘¤</span><input type="text" id="username" required></div>
    <div class="input-group"><span>ğŸ“</span><input type="text" id="fullname" required></div>
    <div class="input-group"><span>ğŸ‚</span><input type="date" id="birthdate" required></div>
    <button type="submit" id="submit-btn" class="btn-success">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
  </form>
  <button class="secondary" id="login-btn" onclick="goToLogin()">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
</div>
</body>
</html>
